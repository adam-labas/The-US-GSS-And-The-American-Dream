---
title: "Income Has Serious Implications On Many Facets of American Life in 2021"
subtitle: "A Look Into The Implications of Americans' Incomes Reveals Information On The Veracity of American Dream."
author: 
  - Adam Labas  
  - Krupali Bhavsar
thanks: "Code and data are available at: XXXXXXXXXXXXXXXXXXXXXXX"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2
toc: TRUE
bibliography: references.bib
---

```{r setup, fig.pos = "!H", include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
# install.packages("tinytex")
# tinytex::install_tinytex()
library(tinytex)
library(tidyverse)
library(janitor)
library(dplyr)
library(tidyr)
library(knitr)
library(patchwork)
library(lubridate)

reduced_data <- read_csv(here::here("inputs/data/reduced_data.csv"))

```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 



# Data

In this Data Section \@ref(data), we will provide a look into the data acquisition and processing methodology as well as a deep dive into the contents of the data. First of, (Table \@ref(tab:tableofdata)) give us a glimpse of the data.



```{r echo = F}
#table of variables that I am concerned with


reduced_data[complete.cases(reduced_data), ] %>%
   slice(1:7) %>%
  kable(
    caption = "GSS Cleaned Data",
    col.names = c("Row Number", "Age", "Gender", "Born", "Marital Status", "Education", 
                  "Divorce Status", "Degree", "Current Income", "Health Care", "Birth Year", 
                  "First Born", "Income at 16", "Grandparents", "Category for Income at 16", 
                  "Caegory for Current Income"),
    digits = 1,
    booktabs = TRUE,  
    linesep = "")
```



## Data Collection

All of the data used in this analysis was directly collected from the United States 2021 General Social Survey, available here: https://gss.norc.org/ (link and additional information available in the README.md file.) We downloaded the desired data in the STATA format and loaded it into R [@citeR] for manipulation. The zip file acquired included 4 files: a read me text file, the raw data as a dta file, as well as two pdf files. *GSS 2021 Codebook R1b* is essentially the instruction manual for the data set. It goes over many topics like the objectives and intents of the survey, a brief overview of the methodology and an in depth explanation of the 565 variables in the raw data. With 565 variables collected in the survey, the data file titles *gss2021.dta* has a size of 2.6 MB. Although this isn't too large of a data file, we did encounter some problems which may have implications as it pertains to reproducibility of the workflow. The following is an explanation of the problems encountered as well as an explanation of the workaround/solution we implemented to get over the obstacle.

## Problem With Data Upload into R Studio
We know that having a reproducible workflow is crucial if we want to produce mature and ethical statistical papers which any data scientist down the line can reproduce for any purpose from verifying results or modifying methodology. As previously stated, the raw data provided by the United States 2021 General Social Survey was in a zip folder and in dta format. To conduct the development of this paper, we worked in RStudio {@citeR) in a server developed, maintained an administered by one of the TAs for the STA304 Course at the University of Toronto (Winter 2022), Mauricio Vargas Sepúlveda, better known as Pachá. This server works just like any other server for RStudio like JupyterHub but the admin user, Pachá, has the ability to overview all activity on the server and access users accounts to aid with trouble shooting or data sharing: this will proved to be decisive in just a moment. When we tried to follow typical procedure to upload the 2021_stata.zip file into under data in the inputs folder, we received a message we had never received before. Figure 1 is a screen capture of that error.
![The Error received upon attempting to upload the zip folder](~/paper_3_team_paper/inputs/2021_stata_error_message.png "The error message we received when trying to upload the zip folder.")

This was hard for us to wrap our heads around as we were able to upload other files independently, and crucially we were able to upload the other file in the zip independently aside from the dta file. We tried to replicate this problem working in RStudio locally but surprisingly it was not a problem there. As such, we contacted the server admin, shared the zip folder with him, and using his administrator permissions, he uploaded the unzipped folder into a shared folder that the entire class has access to. We then copped this folder into the data folder under inputs. It is important to note that throughout this process, none of the information from the zip folder had been altered or manipulated and that all the information, and only the information, which had started in it, ended up in our instance of RStudio.

Lastly on this matter, should you run into this problem while attempting to reproduce our findings or work, working locally in RStudio might fix the problem.

## Data Processing and Variable Selection

Upon being able to successfully load the data into R (@citeR) we began data processing and variable selction. This includes things like cleaning the data from missing values, choosing the variables of interest and producing new variables which will help us with our analysis. The following is an overview of the methods and events which took place in this phase of the analysis.

All the data processing, cleaning and variable selection takes place in an R script called *Data Acquisition and Processing.R* in the scripts folder. To process our data, we began by loading all the necessary libraries like haven [@citehaven] which was used to acess the information from the dta type file and we then load the data into R [@citeR]. Additionally, we used a wide variety of libraries like knitr [@citeknitr], tidyverse [@citetidyverse], tidyr [@citetidyr], janitor [@citejanitor], dplyr [@citetidyr] as well as tinytex [@citetinytex] at some points in the process for data processing and pdf document generation.

After loading the data into our local environment and saving its as a cvs called raw.csv, we began to create as subset of the data with the desired variables. There are 565 variables in the data and we obviously can't explain each of them, so here is a description of some of the variables we chose to work with. *sexnow1* is the current sex of the respondent and is a concept more similar to gender, *age*, *born*: born in America or not, *marital*: the marital status, *educ*: the highest attained level of education, *divorce*: divroced or not, whether or not they have a *degree*, *income*: their current family income, *income16*: their family income when they were 16 years old, *nathealy*: if they think enough is done for healthcare, *cohort*: year of birth, *agekdbrn*: age when first child was born and lastly, *granborn* which is a number from 0-4 signifying the number of grandparents of the respondent which were born in the united states.

Additionally, we created a new column called *income_cat* and *income16_cat* which are new variables which offer us the liberty of using the *income* and *income16* variables but as discreet, categorical variables instead of the coded numerical system used all throughout the data set and explained in the information code book titled *GSS 2021 Codebook R1b.pdf* available in the 2021_stata in the data folder in inputs.This was done by duplicating the original columns and then re-coding the values. In the case of *income* for instance, the code book explains that a value of 1 for income means the response was that the annual income was less than \$1000. As such, income_cat would read *$1,000 AND UNDER*. Similar mutations were done for the variables *sex*, *granborn*, *nathealy* and *born*.

We finished off by saving all the changed in a new data set: reduced_data.csv


# Methodology

In matters of reproducibility, the methodology used to collect data is always important. This includes the various sampling techniques that were used, the way that non responses are dealt with and other key decisions taken by the data collection team and the survey itself. The following is an explanation of the methodology used in the 2021 GSS, as well as its key features, strengths, and weaknesses.

## Methodology Overview

The 2021 GSS is in many ways different to the previous General Social Surveys in years prior to the ascension of the corona virus to international stardom. According to the GSS 2021 Codebook R1b, in previous iterations of the GSS, the survey was taken solely via in-person interview, where the interviewer had been adequately trained and prepared for various situations that would have arose like non responds or the person being interviewed not knowing an answer. However, for reasons related to health and safety protocols and "to safeguard the health of staff and respondents during the COVID-19 pandemic, the 2021 GSS data collection used a mail-to-web methodology instead of its traditional in-person interviews." This means that after being selected via address based sampling the selected individuals "interview" would be conducted online via a self administered questionnaire. The limitations of such will later be discussed in Section \@ref(limitations)

## Key features & Pros And Cons of the Methodology and Survey

It is important to discuss the reach of our data. We know from the provided documentation that the population group eligible for taking the survey are Adults 18 or older in the United States who live in non institutional housing at the time of interviewing. Also, the 2021 GSS  uses the last birthday method to decide which individual in the household will take the survey. This was done by having "a professional phone interviewer team conducted phone outreach to complete screeners, answer inbound phone calls from sampled households, identify respondents, and complete interviews by phone and/or prompt them to complete the web survey." As far as the invitation method goes for data collection, materials that provide a web link to invite people to participate in the survey was mailed out and an option to conduct the interview via the phone instead of a self-administered questionnaire was also provided. Out of the 27,591 lines of sample (people who had been prompted to answer the questionnaire), 4,032 responses were collected. This has implications on the finding of our analysis in Section \@ref(discussion) as we will have to consider if we are able to generalize our finding from the relatively small sample that we have to the population if all US citizens over 18 years old. The small sample size and extremely long survey are both weaknesses of the survey which we will discuss in more depth in Section \@ref(results).

In addition, the 2021 GSS used census data as well as publicly available information to try and identify areas and specific household with Spanish speakers whereby the survey was then offered in English and in Spanish. This is a big strength of the survey at it shows the attempt of the data analyst to be as mature and ethical as possible and offer the survey in a language that is more suitable for a large portion of US citizens.



# Visualizing the Data and The Implications
In this analysis, I am interested at looking at how real is the American Dream and if it is found to be possible, whether or not there is any difference in attainment amoung genders. As such, in this Section \@ref(visualizing-the-data-and-the-implications), we will create various visuals which will enable us to extract as much information as we can and we will speak about the implications that they make.
```{r, echo = F, message = F, include = F}
#creating levels for the x and y axis on the graphs

level_income16 <- c("$1,000 AND UNDER","$1,000 TO $2,999","$3,000 TO $3,999",
                    "$4,000 TO $4,999","$5,000 TO $5,999","$6,000 TO $6,999",
                    "$7,000 TO $7,999","$8,000 TO $9,999","$10,000 TO $12,499",
                    "$12,500 TO $14,999", "$15,000 TO $17,499","$17,500 TO $19,999",
                    "$20,000 TO $22,499","$22,500 TO $24,999","$25,000 TO $29,999",
                    "$30,000 TO $34,999","$35,000 TO $39,999","$40,000 TO $49,999",
                    "$50,000 TO $59,999","$60,000 TO $74,999","$75,000 TO $89,999",
                    "$90,000 TO $109,999","$110,000 TO $129,999","$130,000 TO $149,999",
                    "$150,000 TO $169,999","$170,000 OR OVER")

level_income <- c("$1,000 AND UNDER","$1,000 TO $2,999","$3,000 TO $3,999",
                    "$4,000 TO $4,999","$5,000 TO $5,999","$6,000 TO $6,999",
                    "$7,000 TO $7,999","$8,000 TO $9,999","$10,000 TO $14,999",
                    "$15,000 TO $19,999","$20,000 TO $24,999","$25,000 OR MORE")
```

## Visual 1
```{r figure 1, fig.cap="write a figure caption here", echo = FALSE, fig.width=12, fig.height=10, message = F, warning = F}
income16_gender <- ggplot(mapping = aes(x = factor(income16_cat, level = level_income16), group = sex, fill = sex), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Family Income at 16 Years Old",
       y = "Number of occurrences",
       fill = "Gender",
       title = "Total Family Income at 16 Grouped by Gender") +
  coord_flip()
income16_gender
```
In this graph (Figure \@ref(fig:figure-1)), we can proportions of family income when the responded was 16 years of age. We also see that an over-whelming majority of people in our sample had an income of over $40,000. We also see that the single largest individual group is the *NA* group. We will discuss the implications of this in Section \@ref(limitations). As we've previously discussed, when the questioned is prompted with a question, in every situation, they have the option to refuse to answer the question or say that they do not know. The both of these are listed as NA responses. We also see that of the 5 possible genders (including the NA gender, not to be confused with the NA response to income16), the overwhelming majority of respondents identified as male or female as expected.

We would like to contrast this with the current income of responds. The below is the same graph above but we've also included a similar graph but for family income at the time of response 
```{r figure2, fig.cap="write a figure caption here", echo = FALSE, fig.width=12, fig.height=10, message = F, warning = F}
#income16 vs income grouped by gender

income16_gender <- ggplot(mapping = aes(x = factor(income16_cat, level = level_income16), group = sex, fill = sex), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Family Income at 16 Years Old",
       y = "Number of occurrences",
       fill = "Gender",
       title = "Total Family Income at 16 Grouped by Gender") +
  coord_flip()

income_gender <- ggplot(mapping = aes(x = factor(income_cat, level = level_income), group = sex, fill = sex), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Family Income",
       y = "Number of occurrences",
       fill = "Gender",
       title = "Total Family Income Grouped by Gender") +
  coord_flip()

income16_gender/income_gender
```
In figure \@ref(fig:figure-2), we see the overlapping of the two graphs, the first of which is the same as figure \@ref(fig:figure-1) and the bottom one is the same in essence but with the information for current family income instead of at age 16. The first and most striking part of this visual is that for the current income, the highest threshold is $25,000 or more. We see that the both of our graphs are heavily skewed to wards higher incomes. I suspect that this is mainly a production of the bin widths decided on for the analysis. 

## Implications 1
In Visuals \@ref(visual-1) we can see when we look into income16 that the majority of people claimed that at the age of 16, their family income was over 40 thousand dollars. When we lookover at the income variable, we are trully perplexed to see that the largest is 25 thousand or more. We will discuss the implications of the latter in Section \@ref(limitations). We can also see that the number of NA responses rises from about 530 in the case of the income at age 16 variable to approximately 900 in the income variable. This seems counter intuitive as it would appear that less people are uncertain about their family income at age 16 than they are. We suspect however that this is not true. We suspect that there could be a possible shame or embarassment assosociated with sharing ones current faily income as it represents the persons way of living or lifestyle today. On the other hand, someones incomeat age 16 is psychologically less of importance to them and carries no burden in their life, as it is notan expected metric of succes year down the line. We also recognize that amongst men and women, there is a general 


```{r, fig.cap="write a figure caption here", echo = FALSE, fig.width=12, fig.height=10, message = F, warning = F}
#fincome16 vs income grouped by where grandparents were born

income16_grand <- ggplot(mapping = aes(x = factor(income16_cat, level = level_income16), group = granborn, fill = granborn), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Family Income at 16 Years Old",
       y = "Number of occurrences",
       fill = "Grandparents",
       title = "Total Family Income at 16 Grouped by Grandparent Birthplace") +
  coord_flip()

income_grand <- ggplot(mapping = aes(x = factor(income_cat, level = level_income), group = granborn, fill = granborn), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Family Income",
       y = "Number of occurrences",
       fill = "Grandparents",
       title = "Total Family Income Grouped by Grandparent Birthplace") +
  coord_flip()

income16_grand/income_grand
```


```{r, fig.cap="write a figure caption here", echo = FALSE, fig.width=12, fig.height=10, message = F, warning = F}
#family income at 16 grouped by where individual was born

income16_born <- ggplot(mapping = aes(x = factor(income16_cat, level = level_income16), group = born, fill = born), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Total Family Income at 16 Years Old",
       y = "Number of occurrences",
       fill = "Born",
       title = "Total Family Income at 16 Grouped by individual’s Birthplace") +
  coord_flip()

income_born <- ggplot(mapping = aes(x = factor(income_cat, level = level_income), group = born, fill = born), data = reduced_data) +
  geom_bar(alpha = 0.7)  +
  theme_minimal() +
  labs(x = "Total Family Income",
       y = "Number of occurrences",
       fill = "Born",
       title = "Total Family Income Grouped by individual’s Birthplace") +
  coord_flip()

income16_born/income_born
```

```{r, fig.cap="write a figure caption here", echo = FALSE, fig.width=9, fig.height=6, message = F, warning = F}
#income at 16 vs current income grouped by where individual was born

income_income16_born <- ggplot(mapping = aes(x = income_cat, y = income16_cat, color = born), data = reduced_data) +
  geom_point() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = "Current Family Income",
       y = "Family Income at Age 16",
       color = "Born in The USA",
       title = "Relationship Between Family Income at age 16 and Current Family Income")

income_income16_born
```





# Limitations

## First discussion point

## Second discussion point

## Third discussion point


## Next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


